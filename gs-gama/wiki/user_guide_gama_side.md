# The GAMA to Graphstream API

This guide contains specifications of all the primitives provided by the gs-gama plug-in. All arguments are given through the facets.

***Warning:*** The `(sourceId, timeId)` of the incoming and leaving events are shared by all the receivers and the senders. It means that if for example receiver1 receives an event coming from the node source with the identifier "foo" with timeId 4, and after that receiver2 receives an event coming from the same source with timeId 2, the second event will be ignored. The sourceId of the GAMA simulation is also taken into account, so the events generated by GAMA senders that come back to GAMA will also be ignored.

## Connect GAMA to Graphstream to send data: the `senders`

Senders connect a GAMA simulation to external receivers and send them graph events generated by the agents. Every agent can create or remove senders. Several senders can be created in the same simulation. For instance, one connected to a visualization application, another one connected to an analysis application and so on.

All senders share common `sourceId` which is automatically created when the extension is loaded. They also have a common timeline (a common `timeId` incremented at each event sent). In this way the whole Gama simulation is seen from outside as a unique source.

When a sender is created, agents can use it to send GraphStream events to external receivers. Each kind of agent can send any kind of events (graph, node, edge).
    
### Add a new connection to send data

`gs_add_sender` creates a sender. One unique graph is associated to a sender. Note that an external receiver must be connected on the other side before calling this command, otherwise a "connection refused error" occurs. If a sender with this identifier already exists, an error occurs.

The mandatory parameters:
* `gs_sender_id`: a string, the unique identifier of the sender
* `gs_host`: a string, the name of the host to connect to
* `gs_port`: a number, the port of the host

### Close a connection

`gs_close` closes a sender. If the specified sender does not exist, an error occurs.

The mandatory parameter:
* `gs_sender_id`: a string, the unique identifier of the sender

### Clear all previous senders

`gs_clear_senders` disconnects and removes all the senders (if any) created with `gs_add_sender`. There is no parameter.

**Example**
```text
init {
  // create a sender connected locally on port 2015
  gs_add_sender gs_sender_id:"my_local_sender" gs_host:"localhost" gs_port:2015
  // create a remote sender
  gs_add_sender gs_sender_id:"my_remote_sender" gs_host:"yoda.galacticrepublic.gov" gs_port:4242

  // close the sender "my_local_sender"
  gs_close gs_sender_id:"my_local_sender";
  // clear all existing senders
  gs_clear_senders
}
```

## Send events

### Graph events

#### Add or modify an attribute on a graph

`gs_add_graph_attribute` adds an attribute on the graph associated to the specified sender. If the specified sender does not exist, an error occurs.

The mandatory parameters:
* `gs_sender_id`: a string, the unique identifier of the sender
* `gs_attribute_name`: a string, the identifier of the graph attribute
* `gs_attribute_value`: a string or a double or an integer or a list of primitive values.

#### Remove an attribute on a graph

`gs_remove_graph_attribute` removes the attribute of the graph associated to the specified sender. If the specified sender does not exist, an error occurs.

The mandatory parameters:
* `gs_sender_id`: a string, the unique identifier of the sender
* `gs_attribute_name`: a string, the identifier of the graph attribute

#### Define a step

`gs_step` send a step event to the graph associated to the specified sender. Graphstream defines the dynamic of a graph as a sequance of events. A step event indicates that previous events (for instance, nodes/edges deletion/addition) have been executed within the same period. If the specified sender does not exist, an error occurs.

The mandatory parameters:
* `gs_sender_id`: a string, the unique identifier of the sender
* `gs_step_number`: an integer

#### Clear a graph

`gs_clear` clears every previous events of the graph associated to the specified sender. If the specified sender does not exist, an error occurs.

The mandatory parameters:
* `gs_sender_id`: a string, the unique identifier of the sender

**Example**
```text
init {
  // Open the connection
  gs_add_sender gs_sender_id:"my_sender" gs_host:"localhost" gs_port:2016

  // Add some attributes
  gs_add_graph_attribute gs_sender_id:"my_sender" gs_attribute_name:"my_first_attribute" gs_attribute_value:"a string value";
  gs_add_graph_attribute gs_sender_id:"my_sender" gs_attribute_name:"my_second_attribute" gs_attribute_value:12.34;
  gs_add_graph_attribute gs_sender_id:"my_sender" gs_attribute_name:"my_third_attribute" gs_attribute_value:1;
  gs_add_graph_attribute gs_sender_id:"my_sender" gs_attribute_name:"my_fourth_attribute" gs_attribute_value:[1,2,3];

  // remove the attribute "my_attribute"
  gs_remove_graph_attribute  gs_sender_id:"my_sender" gs_attribute_name:"my_first_attribute";

  // send a step event
  gs_step gs_sender_id:"my_sender" gs_step_number:4;

  // clear the graph
  gs_clear gs_sender_id:"my_sender";
}
```

### Node events

#### Add a node

`gs_add_node` add a node to the graph associated to the specified sender. If the specified sender does not exist, an error occurs.

The mandatory parameters:
* `gs_sender_id`: a string, the unique identifier of the sender
* `gs_node_id`: a string, the unique identifier of the node in the graph.

#### Remove a node

`gs_remove_node` remove a node to the graph associated to the specified sender. If the specified sender does not exist, an error occurs.

The mandatory parameters:
* `gs_sender_id`: a string, the unique identifier of the sender
* `gs_node_id`: a string, the unique identifier of the node in the graph.

#### Add or modify an attribute on a node

`gs_add_node_attribute` add an attribute with its value to a node which belongs to the graph associated to the specified sender. If the specified sender does not exist, an error occurs.

The mandatory parameters:
* `gs_sender_id`: a string, the unique identifier of the sender
* `gs_node_id`: a string, the unique identifier of the node in the graph
* `gs_attribute_name`: a string, the identifier of the node attribute
* `gs_attribute_value`: a string or a double or an integer or a list of primitive values.

#### Remove an attribute on a node

`gs_remove_node_attribute` remove an attribute to a node which belongs to the graph associated to the specified sender. If the specified sender does not exist, an error occurs.

The mandatory parameters:
* `gs_sender_id`: a string, the unique identifier of the sender
* `gs_node_id`: a string, the unique identifier of the node in the graph
* `gs_attribute_name`: a string, the identifier of the node attribute.

**Example**
```text
init {
  // Open the connection
  gs_add_sender gs_sender_id:"my_sender" gs_host:"localhost" gs_port:2016

  // Add a node
  gs_add_node gs_sender_id:"my_sender" gs_node_id:"node1";

  // Add some attributes
  gs_add_node_attribute gs_sender_id:"my_sender" gs_node_id:"node1" gs_attribute_name:"my_first_attribute" gs_attribute_value:"a string value";
  gs_add_node_attribute gs_sender_id:"my_sender" gs_node_id:"node1" gs_attribute_name:"my_second_attribute" gs_attribute_value:12.34;
  gs_add_node_attribute gs_sender_id:"my_sender" gs_node_id:"node1" gs_attribute_name:"my_third_attribute" gs_attribute_value:1;
  gs_add_node_attribute gs_sender_id:"my_sender" gs_node_id:"node1" gs_attribute_name:"my_fourth_attribute" gs_attribute_value:[1,2,3];
  // Set an existing attribute
  gs_add_node_attribute gs_sender_id:"my_sender" gs_node_id:"node1" gs_attribute_name:"my_third_attribute" gs_attribute_value:2;

  // remove the attribute "my_attribute"
  gs_remove_node_attribute  gs_sender_id:"my_sender" gs_node_id:"node1" gs_attribute_name:"my_first_attribute";
}
```

### Edge events

#### Add an edge

`gs_add_edge` add an edge to the graph associated to the specified sender. If the specified sender does not exist, an error occurs.

The mandatory parameters:
* `gs_sender_id`: a string, the unique identifier of the sender
* `gs_edge_id`: a string, the unique identifier of the edge in the graph.
* `gs_node_id_from`: a string, the identifier of the first node.
* `gs_node_id_to`: a string, the identifier of the second node.
* `gs_is_directed`: a boolean, true if the edge is directed, false otherwise.

#### Remove an edge

`gs_remove_edge` remove an edge to the graph associated to the specified sender. If the specified sender does not exist, an error occurs.

The mandatory parameters:
* `gs_sender_id`: a string, the unique identifier of the sender
* `gs_edge_id`: a string, the unique identifier of the edge in the graph.

#### Add or modify an attribute on an edge

`gs_add_edge_attribute` add an attribute with its value to an edge which belongs to the graph associated to the specified sender. If the specified sender does not exist, an error occurs.

The mandatory parameters:
* `gs_sender_id`: a string, the unique identifier of the sender
* `gs_edge_id`: a string, the unique identifier of the edge in the graph
* `gs_attribute_name`: a string, the identifier of the node attribute
* `gs_attribute_value`: a string or a double or an integer or a list of primitive values.

#### Remove an attribute on an edge

`gs_remove_edge_attribute` remove an attribute to an edge which belongs to the graph associated to the specified sender. If the specified sender does not exist, an error occurs.

The mandatory parameters:
* `gs_sender_id`: a string, the unique identifier of the sender
* `gs_edge_id`: a string, the unique identifier of the edge in the graph
* `gs_attribute_name`: a string, the identifier of the node attribute.

**Example**
```text
init {
  // Open the connection
  gs_add_sender gs_sender_id:"my_sender" gs_host:"localhost" gs_port:2016

  // Add two nodes
  gs_add_node gs_sender_id:"my_sender" gs_node_id:"node1";
  gs_add_node gs_sender_id:"my_sender" gs_node_id:"node2";

  // Add a directed edge
  gs_add_edge gs_sender_id:"my_sender" gs_edge_id:"edge1" gs_node_id_from:"node1" gs_node_id_to:"node2" gs_is_directed:true;

  // Add some attributes
  gs_add_edge_attribute gs_sender_id:"my_sender" gs_node_id:"edge1" gs_attribute_name:"my_first_attribute" gs_attribute_value:"a string value";
  gs_add_edge_attribute gs_sender_id:"my_sender" gs_node_id:"edge1" gs_attribute_name:"my_second_attribute" gs_attribute_value:12.34;
  gs_add_edge_attribute gs_sender_id:"my_sender" gs_node_id:"edge1" gs_attribute_name:"my_third_attribute" gs_attribute_value:1;
  gs_add_edge_attribute gs_sender_id:"my_sender" gs_node_id:"edge1" gs_attribute_name:"my_fourth_attribute" gs_attribute_value:[1,2,3];

  // Set an existing attribute
  gs_add_edge_attribute gs_sender_id:"my_sender" gs_node_id:"edge1" gs_attribute_name:"my_third_attribute" gs_attribute_value:2;

  // remove the attribute "my_attribute"
  gs_remove_edge_attribute  gs_sender_id:"my_sender" gs_node_id:"edge1" gs_attribute_name:"my_first_attribute";
}
```
## Connect GAMA to Graphstream to receive data: the `receivers`

Every GAMA agent can create and manage one or many receiver. Each receiver is runned in a separated thread and accumulates the received events. If the received event are not processed sometimes (or flushed), then a heap overflow will occurs.

### Add a new connection to receive data

`gs_add_receiver` opens a connection where a Graphstream-based application can be connected and send graph events to the GAMA simulation.

The mandatory parameters:
* `gs_receiver_id`: a string, the unique identifier of the receiver
* `gs_host`: a string, the name of the host to connect to
* `gs_port`: a number, the port of the host.

The optional parameter:
* `gs_attributes_filtered`: a list of string containing each attribute name that can be ignored be the receiver.

### Clear all previous receivers

`gs_clear_receivers` disconnects every existing receivers. There is no parameters.

### Clear the received flow of events

`gs_flush` deletes every received events of the specified receiver and which are waiting to be processed. If the specified receiver does not exist, an error occurs.

The mandatory parameter:
* `gs_receiver_id`: a string, the unique identifier of the receiver.

### Get the values of a graph attribute

`gs_get_graph_attribute` returns the list of every values taken by the given attribute of the graph associated with the specified receiver since the last call of this method, or since the last call of `gs_flush`. If the specified receiver does not exist, an error occurs.

The mandatory parameter:
* `gs_receiver_id`: a string, the unique identifier of the receiver
* `gs_attribute_name`: a string, the name of the attribute
* `returns`: a variable of type `list` that will contains the list of values of the attribute. The type of the values received must be primitive (string, double, integer, boolean, or an array of these primitives types).

### Get the values of a node attribute

`gs_get_node_attribute` returns the list of every values taken by the given attribute of the given node which belongs to the graph associated with the specified receiver since the last call of this method, or since the last call of `gs_flush`. If the specified receiver does not exist, an error occurs.

The mandatory parameter:
* `gs_receiver_id`: a string, the unique identifier of the receiver
* `gs_node_id`: a string, the unique identifier of the node in the graph
* `gs_attribute_name`: a string, the name of the attribute
* `returns`: a variable of type `list` that will contains the list of values of the attribute. The type of the values received must be primitive (string, double, integer, boolean, or an array of these primitives types).

### Get the values of an edge attribute

`gs_get_edge_attribute` returns the list of every values taken by the given attribute of the given edge which belongs to the graph associated with the specified receiver since the last call of this method, or since the last call of `gs_flush`. If the specified receiver does not exist, an error occurs.

The mandatory parameter:
* `gs_receiver_id`: a string, the unique identifier of the receiver
* `gs_edge_id`: a string, the unique identifier of the edge in the graph
* `gs_attribute_name`: a string, the name of the attribute
* `returns`: a variable of type `list` that will contains the list of values of the attribute. The type of the values received must be primitive (string, double, integer, boolean, or an array of these primitives types).

### Wait for the next step

`gs_wait_step` engages a blocking process allowing to synchronize GAMA with the Graphstream-based application. If the Graphstream-based application never send such an event, the primitive will never end and the simulation will be blocked. If the specified receiver does not exist, an error occurs.

 The mandatory parameter:
* `gs_receiver_id`: a string, the unique identifier of the receiver
* `gs_return`: a variable of type double which will contains the value associated with the last step event received and not yet processed.

**Example**
```text
init {
  // Open the conenction in order to receive data
  gs_add_receiver gs_receiver_id:"my_receiver" gs_host:"localhost" gs_port:3001;

  // Wait step in order to be synchronized with the Graphstream-based application
  syncStep <- 0.0;
  gs_wait_step gs_receiver_id:"my_receiver" gs_return:syncStep;

  // Get graph attribute(s)
  // It is assumed that the graph attribute "a" exists, otherwise, "val" will stay empty
  list val <- [];
  gs_get_graph_attribute gs_receiver_id:"my_receiver" gs_attribute_name:"a" returns:val;
  int i<- 0;
  loop while: i < length(val) {
    write val[i];
    i <- i + 1;
  }

  // Get node attribute(s)
  // It is assumed that the node "node0" and its attribute "na" exist, otherwise, "val" will stay empty
  val <- [];
  gs_get_node_attribute gs_receiver_id:"my_receiver" gs_node_id:"node0" gs_attribute_name:"na" returns:val;
  int i <- 0;
  loop while: i < length(val) {
    write val[i];
    i <- i + 1;
  }

  // Get edge attribute(s)
  // It is assumed that the edge "edge0_1" and its attribute "ea" exist, otherwise, "val" will stay empty
  val <- [];
  gs_get_edge_attribute gs_receiver_id:"my_receiver" gs_edge_id:"edge0_1" gs_attribute_name:"ea" returns:val;
  i<- 0;
  loop while: i < length(val) {
    write val[i];
    i <- i + 1;
  }

  // Flush the given receiver
  gs_flush gs_receiver_id:"test2";

  // Clear all receivers
  gs_clear_receivers;
}
```